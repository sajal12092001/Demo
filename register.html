<html>

<head>
    <title>Registration</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .head {
            position: absolute;
            left: 35%;
        }

        .main {
            display: flex;
        }
    </style>
</head>

<body>

    <div class="container head " id="head">
        <h2 style="margin-left: 8%;">Register here</h2>
        <span id="span" style="color: red; margin-left: 50px;"></span>
        <form method="post" action="#" name="registerform" onsubmit="return validation()">

            <div class="main">
                <div>
                    <div id="firstname" class="mb-3 form-group " style="margin-right: 25px;">
                        <label>First Name</label>
                        <input type="text" class="form-control " placeholder="Enter first name" id="fname">
                        <p style="color: red;" class="formerror"></p>

                    </div>
                </div>

                <div>
                    <div id="lastname" class="mb-3 form-group">
                        <label>Last Name</label>
                        <input type="text" class="form-control mr-5" placeholder="Enter last name" id="lname">
                        <p style="color: red;" class="formerror"></p>
                    </div>
                </div>

            </div>


            <div class="main">
                <div>
                    <div id="mob" class="form-group mb-3" style="margin-right: 25px;">
                        <label>Mobile</label>
                        <input type="number" class="form-control " placeholder="Enter mobile" id="mobile">
                        <p style="color: red;" class="formerror"></p>
                    </div>
                </div>

                <div>

                    <div id="bios" class="form-group mb-3">
                        <label>Bio</label>
                        <input type="textarea" class="form-control mr-5" placeholder="Enter your bio" id="bio">
                        <p style="color: red;" class="formerror"></p>
                    </div>

                </div>

            </div>



            <div class="main">
                <div>
                    <div id="gen" class="form-group mb-3" style="margin-right: 25px; width: 206px;">
                        <label>Gender</label>

                        <select name="gender" class="form-control " id="genderlist">
                            <option value="selectgender">- Select Gender -</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="transgender">Transgender</option>
                        </select>
                        <p style="color: red;" class="formerror"></p>
                    </div>
                </div>

                <div>
                    <div id="Dob" class="form-group mb-3" style="width: 203px;">
                        <label>Dob</label>
                        <input type="date" class="form-control mr-5" placeholder="Enter your dob" id="dob">
                        <p style="color: red;" class="formerror"></p>
                    </div>
                </div>

            </div>


            <div class="main">
                <div>

                    <div id="mail" class=" mb-3" style="margin-right: 25px;">
                        <label>Email</label>
                        <input type="email" class="form-control mr-5" placeholder="Enter email" id="email">
                        <p id="emailerror" style="color: red;" class="formerror"></p>
                    </div>
                </div>

                <div>
                    <div id="agee" class=" mb-3">
                        <label>Age</label>
                        <input type="number" class="form-control mr-5" placeholder="Enter your age" id="age">
                        <p style="color: red;" class="formerror"></p>
                    </div>
                </div>

            </div>

            <div id="pass" class=" mb-3" style="margin-right: 865px;">
                <label>Password</label>
                <input type="password" class="form-control mr-5" placeholder="Enter password" id="password">
                <p style="color: red;" class="formerror"></p>
            </div>

            <button type="button" id="register" onclick="javascript:fetchData()" value="Register"
                class="btn btn-primary" style="margin-left: 150px;">Register</button>


        </form>
    </div>

</body>

<script>

    function fetchData() {

        if (true) {
            let mail = document.getElementById('email').value;

            const xhr = new XMLHttpRequest();


            xhr.open('get', 'fetch.php', true);
            xhr.send();



            xhr.onload = function () {

                try {
                    var flag = 0;
                    let data = JSON.parse(this.responseText);
                    console.log(data);

                    if (data.length > 0) {
                        console.log("data lenght");
                        for (var a = 0; a < data.length; a++) {
                            let getmail = data[a].email;
                            console.log(getmail);
                            console.log("chek email: " + mail);

                            if (getmail == mail) {
                                flag = 1;
                                console.log(true);
                                document.getElementById("emailerror").innerHTML = "Email already exist";

                                break;
                            }
                            

                        }
                        if (flag == 0) {
                            document.getElementById("emailerror").innerHTML = "";
                            sendData();
                            location.replace("login.php");
                        }

                    }
                    else {
                      
                        sendData();
                        location.replace("login.php");
                    }


                } catch (e) {
                    alert(e)
                    console.log(e);

                }


            }



        }



    }


    function sendData() {

        let fname = document.getElementById('fname').value;
        let lname = document.getElementById('lname').value;
        let mobile = document.getElementById('mobile').value;
        let bio = document.getElementById('bio').value;
        let gender = document.getElementById('genderlist').value;
        let dob = document.getElementById('dob').value;
        let email = document.getElementById('email').value;
        let age = document.getElementById('age').value;
        let password = document.getElementById('password').value;


        const xhr = new XMLHttpRequest();

        xhr.open('post', 'register.php', true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

        xhr.onload = function () {
            // do something to response
            console.log(this.responseText);
        };

        try {
            xhr.send("fname=" + fname + "&lname=" + lname + "& mobile=" + mobile + "& bio=" + bio + "&gender=" + gender + "& dob=" + dob + " & email=" + email + "& age=" + age + "& password=" + password);

        }
        catch (ex) {
            alert("hello");
            alert(ex);
        }

    }

    function seterror(id, error) {
        element = document.getElementById(id);
        element.getElementsByClassName('formerror')[0].innerHTML = error;

    }
    function validation() {

        let first_name = document.getElementById('fname').value
        let last_name = document.getElementById('lname').value
        let mobi = document.getElementById('mobile').value

        let dobb = document.getElementById('dob').value
        let mail = document.getElementById('email').value
        let ageee = document.getElementById('age').value
        let psw = document.getElementById('password').value

        var gend,
            element = document.getElementById('genderlist');
        if (element != null) {
            gend = element.value;
        }
        else {
            gend = null;
        }




        if (first_name == "" && last_name == "" && mobi == "" && gend == "selectgender" && dobb == "" && mail == "" && ageee == "" && psw == "") {
            document.getElementById("span").innerHTML = "Please provide all fields";

            return false;

        }




        // for first name


        const pattern = /[A-Za-z]/i;

        if (first_name == "") {
            seterror("firstname", "First Name Not be Empty");

            return false;

        }
        else if (!pattern.test(first_name)) {

            seterror("firstname", "First Name should be in alphabets");

            return false;
        }
        // else {
        //     element.getElementsByClassName('formerror')[0].innerHTML = "";


        // }



        // for last name


        if (last_name == "") {
            seterror("lastname", "Last Name Not be Empty");

            return false;
        }
        else if (!pattern.test(last_name)) {

            seterror("lastname", "Last Name should be in alphabets");

            return false;
        }
        // else {
        //     element.getElementsByClassName('formerror')[0].innerHTML = "";


        // }


        // mobile


        if (mobi == 0) {
            seterror("mob", "Mobile Not be Empty");
            return false;
         } 
         //else {
        //     element.getElementsByClassName('formerror')[0].innerHTML = "";

        // }

        let boiss = document.getElementById('bio').value

        if (boiss.length == 0) {
            seterror("bios", "Bio Not be Empty");

            return false;
         } 
         //else {

        //     element.getElementsByClassName('formerror')[0].innerHTML = "";

        // }


        //gender 


        if (gend == "selectgender") {
            seterror("gen", "Gender Not be Empty");

            return false;
        } 
        // else {

        //     element.getElementsByClassName('formerror')[0].innerHTML = "";

        // }


        // dob


        if (!dobb) {
            seterror("Dob", "Dob Not be Empty");

            return false;
        } 
        // else {
        //     element.getElementsByClassName('formerror')[0].innerHTML = "";


        // }


        //mail



        if (mail == "") {
            seterror("mail", "Email Not be Empty");

            return false;
        }
        //  else {
        //     element.getElementsByClassName('formerror')[0].innerHTML = "";


        // }


        //age

        if (ageee == "") {
            seterror("agee", "Age Not be Empty");

            return false;
        } 
        // else {
        //     element.getElementsByClassName('formerror')[0].innerHTML = "";


        // }


        // password
        const pswpattern = /^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{6,16}$/i;

        if (psw == "") {
            seterror("pass", "Password Not be Empty");

            return false;
        }
        else if (!pswpattern.test(psw)) {

            seterror("pass", "Password must include at least one number!<br>     Password must include at least one letter!<br>     Password must include at least one CAPS!<br>     Password must include at least one symbol!<br>");

            return false;
        }

        // else {
        //     element.getElementsByClassName('formerror')[0].innerHTML = "";


        // }
    }
</script>

</html>